/*
--------------------------------------------------
    James William Fletcher (github.com/mrbid)
        October 2021
--------------------------------------------------

    CS:GO GOLD FNN
    
    Prereq:
    sudo apt install libx11-dev libxdo-dev libxdo3 libespeak1 libespeak-dev espeak

    Compile:
    clang csgo_gold_fnn.c -Ofast -mavx -mfma -lX11 -lxdo -lespeak -lm -o fgold
*/

#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdint.h>
#include <math.h>
#include <time.h>
#include <sys/time.h>
#include <X11/Xutil.h>
#include <sys/stat.h>

#include <xdo.h>
#include <espeak/speak_lib.h>

#pragma GCC diagnostic ignored "-Wgnu-folding-constant"
#pragma GCC diagnostic ignored "-Wunused-result"

#define SCAN_DELAY 1000
#define ACTIVATION_SENITIVITY 0.9f
#define REPEAT_ACTIVATION 0

#define uint unsigned int
#define SCAN_WIDTH 28
#define SCAN_HEIGHT 28

const uint sw = SCAN_WIDTH;
const uint sh = SCAN_HEIGHT;
const uint sw2 = sw/2;
const uint sh2 = sh/2;
const uint slc = sw*sh;
const uint slall = slc*3;

float input[slall] = {0};

Display *d;
int si;
Window twin;
unsigned int x=0, y=0;
unsigned int tc = 0;

char targets_dir[256];
char nontargets_dir[256];


/***************************************************
   ~~ Neural Network Forward-Pass
*/
const float aim_model[] = {-0.16248491,-0.17411424,-0.40278798,-0.36600763,-0.22809236,-0.45814657,-0.3101593,-0.069506764,-0.26877236,0.13391082,0.2965191,0.042761274,0.099029824,0.29207936,0.1480605,-0.29743102,-0.12144599,-0.3459987,-0.039333723,0.01024534,-0.22886288,0.06904119,0.15742199,0.036482908,-0.1560789,-0.038312227,0.016610768,0.104657136,0.12277103,0.13989738,-0.14511156,0.05382376,-0.05614177,0.04296084,0.08864449,0.09470569,0.11516958,0.12076259,0.03682955,0.17590252,0.2122739,0.19567752,-0.20299111,-0.12133988,0.016237201,-0.20498295,-0.11730513,-0.15609859,-0.027208196,0.019852199,-0.05166219,0.08456775,0.18406487,0.12017728,-0.059845936,0.034040477,0.043730814,-0.09336396,0.066686645,0.114298515,-0.1034976,0.066481784,0.11229596,-0.08393557,0.049604118,-0.043654926,-0.00044755667,0.12872034,-0.009853975,-0.09654989,0.11395427,-0.07655244,0.09859441,0.2263178,0.19256736,-0.08574704,0.19800726,0.3048294,-0.34053376,-0.0961804,-0.08014486,-0.1980863,0.12710391,0.085923836,0.03432572,0.15622638,0.20561685,-0.08024823,0.10262876,0.28428617,-0.11336949,0.17691274,0.15568905,-0.27568156,-0.12051121,-0.18065187,-0.054255944,-0.036030356,-0.08291201,0.01621406,0.0058380766,0.027441282,-0.031040005,0.04036019,0.084530935,0.1175753,0.15323395,0.10903138,-0.047253538,0.026507903,-0.02739884,0.15815909,0.17418271,0.061554547,0.03871318,0.124860846,0.15469456,-0.27328297,-0.06904809,0.018503357,0.042061187,0.2688178,0.2894615,-0.15744348,-0.026430273,0.07471978,-0.07912696,-0.048482228,-0.025870992,-0.16158064,-0.050082467,-0.09774129,0.027340442,0.024164582,0.100785,0.21845208,0.12054675,0.048606195,0.13115872,0.029371982,0.08103253,-0.079960175,-0.034151062,0.015222775,0.19754411,0.24596226,0.17850928,0.39436734,0.22289205,0.053617682,0.11451766,0.13877329,-0.087532625,-0.26124066,0.0072146547,-0.23246646,-0.04609122,0.21556275,0.14242335,-0.1252538,0.24129127,0.1403705,-0.3288461,-0.18077862,-0.34400523,0.049432475,0.13138501,-0.020978829,0.028454471,0.121750005,0.1844382,0.07571275,0.23883247,0.25538403,0.122247405,0.34526727,0.38912013,-0.088548295,0.08928684,0.14684968,0.06187853,0.049026415,-0.09364167,0.13802558,0.121292666,-0.031011237,0.08865715,-0.01774911,0.03679959,0.16045882,0.008240012,0.15749188,0.16408157,0.009626611,0.027150858,0.002628726,-0.03132679,0.023240238,-0.18993916,-0.13626905,0.026572969,-0.0017571305,0.07450989,0.18222424,0.033457253,0.025732119,0.0048387717,0.11751132,0.14668898,0.12402236,-0.06666285,-0.1415618,-0.18530533,0.1566701,0.12894116,0.009936472,0.3256128,0.3734959,0.2459141,0.05279173,-0.027845481,-0.0315391,-0.15428396,-0.16677028,-0.23180608,-0.2524616,-0.26232284,-0.3307465,-0.038983304,-0.1048096,-0.008022443,-0.02453721,-0.10801491,-0.15036398,-0.0037877525,-0.03308864,-0.14423585,-0.074391656,-0.062413417,-0.40488082,-0.22723654,-0.08464339,-0.12553939,-0.23237641,0.034804936,0.053211275,-0.17418754,0.03406865,-0.040627204,0.05420107,0.19586459,0.12466709,-0.34024566,-0.18754156,-0.17139715,-0.11764592,-0.047488015,-0.015635699,-0.28720617,-0.26067176,-0.10612769,-0.20427792,-0.15437548,-0.25205725,-0.21891166,-0.17974322,-0.28082934,-0.0988006,-0.06952384,-0.21611919,-0.009627054,-0.12981543,-0.3293382,0.110183984,-0.15517566,-0.14686044,0.04756748,-0.12584417,-0.1242626,-0.042155486,-0.007577339,0.039358247,-0.19841632,-0.0741109,0.24405926,-0.014731726,-0.0019624068,0.20818809,0.1548997,0.15362503,0.20560755,0.046078738,0.06776013,0.07361294,0.2007793,0.20200217,0.12840435,-0.08425219,-0.045559864,0.067486875,0.046454288,-0.03888423,-0.056782003,-0.2181072,-0.17550513,-0.31665042,0.00075665704,-0.09110748,-0.20669043,-0.041532252,-0.06700637,-0.13096732,0.06954118,0.023041917,-0.22982512,0.021007173,-0.016675936,-0.25582004,0.10165023,0.17128581,0.002381342,-0.004245455,0.07387088,-0.16888626,-0.022972804,0.0033549925,-0.18057227,0.015153414,0.16116716,0.048526205,-0.10048576,-0.027571259,-0.25142938,0.08194894,0.08917165,-0.08665708,-0.06258855,-0.046673927,0.027357437,-0.1142484,-0.055410624,0.036503863,0.05006092,0.082506225,0.20207839,-0.1324935,0.08812328,-0.012934946,0.012984185,0.16436516,0.123999834,0.22195077,0.23225948,0.047594257,0.16119719,0.077065445,0.005084591,0.2780597,0.055121288,0.1380853,-0.04304133,-0.15022898,-0.10927917,-0.025890807,0.0713556,0.088277,-0.06742325,0.004427022,0.3081222,0.06741093,0.11803271,0.4526295,-0.1511861,-0.020606028,0.15966134,-0.09943192,0.031791143,-0.011596206,0.13830908,0.24561176,0.047072925,-0.052703656,-0.00867362,0.016592728,-0.007065055,-0.08746556,-0.23532556,-0.23231713,-0.18859121,-0.19940695,-0.19401698,-0.070413955,-0.16160093,0.09106174,0.21393818,0.16328795,-0.28044528,-0.34453556,-0.30382532,0.2080574,0.31776273,0.101473846,0.16055626,0.22264959,-0.033283703,-0.008094933,0.11339816,-0.01612288,0.35897535,0.40328455,0.10378767,-0.24822454,-0.033469208,-0.18257298,-0.21766733,-0.08403148,-0.3884732,0.122746356,0.1909725,0.053218644,-0.055785738,0.025147524,0.1041586,0.106423944,0.04603688,0.22425206,0.21662156,0.23046283,0.23816937,0.17230113,0.14950156,0.15833168,0.03894131,-0.037176464,-0.09125578,-0.07636138,-0.19744737,-0.21268228,0.17152618,0.11224357,0.04617027,-0.04472542,-0.13087757,0.081453666,-0.008816249,-7.264506e-05,0.3065769,-0.27309883,-0.20402075,-0.16499302,-0.08588631,-0.12857355,-0.04186038,-0.1515469,-0.254019,-0.22756892,0.016022531,0.12074853,0.120289996,-0.36420587,-0.23683305,-0.10169744,-0.030057868,0.02105867,-0.045349468,-0.0986841,0.033982415,0.13354012,-0.036613494,0.10490839,0.027978938,0.057315223,0.1522707,0.116408646,0.05099535,0.06690229,0.0835984,0.04180626,0.2401729,0.28496897,-0.182092,-0.0036881242,0.056926936,-0.23804986,-0.118481606,-0.12837918,0.18379582,0.27093,0.24712743,-0.07556468,0.061598673,-0.07968838,0.03268981,0.18557623,0.04549004,0.06282118,0.17632927,0.06646964,-0.086389594,0.1252571,0.052781112,-0.003530539,0.08073871,0.10431617,-0.11929793,0.0395721,0.14075446,-0.037579473,-0.06880929,-0.006282478,-0.30351365,-0.29677293,-0.2337057,0.14238077,0.22459736,0.2318531,0.07619439,-0.0585557,-0.1661401,-0.04816171,-0.20027348,-0.38300171,-0.0362786,-0.25999483,-0.41325602,-0.0497089,-0.20813078,-0.15752232,-0.03514637,-0.059453815,-0.024074564,-0.11528949,0.108139545,-0.0023074646,0.009897569,0.2585818,0.18636078,-0.16735026,-0.23909248,-0.49385616,0.19920659,0.15902843,-0.09119708,0.10969352,0.051549785,-0.25452495,0.32050702,0.32932228,0.14112277,0.11682191,0.1596019,-0.0039615775,0.4277396,0.32928693,0.28838307,0.08169895,0.07200212,-0.1240321,-0.074121594,-0.19251576,-0.23967452,-0.24964866,-0.27046216,-0.39308503,-0.086289346,0.1786379,0.27955824,-0.038652662,0.15972708,0.14329709,-0.12408949,-0.025772536,0.08208283,-0.025074437,0.021029906,0.12709096,-0.07869258,-0.08686081,-0.17939334,0.037415083,0.057811752,-0.0597312,0.16421928,0.33572704,0.20397246,-0.063502654,-0.034470838,-0.16539752,-0.01904338,0.10778259,0.18101293,-0.14650199,-0.121729486,-0.07732158,0.05213639,0.0716353,-0.020080283,0.16191685,0.1856691,0.19754602,-0.13115667,-0.2513986,-0.38759825,0.016435932,-0.19495958,-0.33325502,-0.18960579,-0.35192958,-0.2961658,0.26989847,0.25042439,0.26318794,0.0017164325,0.048210513,0.023516601,0.19501823,0.2461551,0.021717379,0.07802312,0.119102135,0.0048551047,0.18646306,0.021639585,-0.34860602,0.45734233,0.31817934,0.13294011,0.15731663,0.20279554,0.2459957,-0.027099345,-0.04598994,-0.095989995,0.091512285,0.14635251,0.09862346,-0.13323528,-0.06392093,-0.063014574,0.050790165,0.030569911,-0.06058617,-0.18550456,-0.23750687,-0.21345998,-0.008258195,0.008941813,-0.04961267,0.24165154,0.29415828,0.24077922,0.035001487,0.1802147,0.3012961,0.21004221,0.2164824,0.2940253,0.1052583,0.23523888,0.35288197,-0.15925126,-0.23611335,-0.31080273,0.027118161,-0.031563118,-0.044669267,0.03367479,0.0275667,-0.09698436,0.012057905,0.08525825,-0.003779409,-0.08285611,0.08564578,0.051780578,-0.016369652,0.019740036,0.010927413,0.046771392,0.1245609,-0.0035725813,-0.075319305,-0.076330714,-0.26113304,-0.023094038,0.03590545,0.05989876,0.28100437,0.22507158,0.15521087,-0.187755,-0.011705961,0.07997058,0.03799464,0.0098705925,0.13332361,0.06712122,0.25345486,0.34286547,0.124400645,0.24655865,0.14170235,-0.117736615,-0.13795696,0.0021064796,0.6068925,0.46172848,0.25091678,-0.08590708,-0.0769854,-0.11423477,0.08801552,0.061275143,-0.07534683,-0.09321153,-0.044722777,-0.07603219,-0.14599107,-0.15591739,-0.062096976,0.046562184,-0.14962742,-0.23684268,-0.027052272,-0.1525376,-0.079219535,0.117975086,0.14336482,0.18601565,-0.40287068,-0.3434577,-0.44479257,0.05621737,-0.009062417,-0.13208115,-0.09456322,-0.079856835,-0.06078578,-0.1729434,-0.06344168,0.18845226,-0.14696106,-0.18818672,-0.21026951,0.026643435,0.019403629,-0.057675164,-0.23267138,-0.26899114,-0.32262957,-0.12810864,-0.20951194,-0.49935603,-0.06165004,-0.03808627,-0.20745903,-0.029860996,0.1848547,0.0297046,-0.015951078,-0.05591947,-0.2466619,-0.012588282,0.0667536,-0.08459066,0.037177432,0.044431064,-0.07409476,0.08107967,-0.0038585905,0.060174357,-0.075199045,-0.0822338,-0.16816494,-0.05527821,0.012004892,-0.051662233,0.22794978,0.1765948,0.15704438,-0.07995155,0.043960597,0.17807905,-0.11237975,-0.01594564,-0.07625082,-0.1785059,-0.12502792,-0.14926323,-0.05889381,-0.13133477,-0.31587967,-0.05292987,-0.20091063,-0.46009427,0.115191594,-0.041622166,-0.19999006,0.19875951,0.018361283,-0.09259381,0.16314499,0.1503159,0.17288038,-0.055005237,-0.06411204,-0.18826571,-0.18847969,-0.21541385,-0.2624053,0.20464426,-0.021867221,0.04236015,0.21094105,0.028211396,-0.17321853,0.13339595,-0.05984677,-0.11073215,0.123294555,-0.011566731,-0.0148577895,-0.19057742,-0.16845097,-0.032785073,0.056599468,0.16388038,0.17202389,-0.021269143,0.0718274,-0.024646383,-0.013351181,0.027021186,0.07365133,0.11539155,0.21453924,0.11990199,-0.13303232,0.06740968,0.13672407,0.15839261,0.47961518,0.344791,-0.16170435,-0.08725529,-0.044870906,-0.10189351,-0.094605066,-0.22477975,0.1971895,0.06258557,-0.088552736,0.030007308,-0.001220042,-0.19189605,0.10947234,0.10446965,-0.064339966,0.11441346,0.024947425,-7.7674486e-05,0.04890753,0.07265686,-0.12832983,0.106854506,-0.0124399485,-0.11828166,-0.26644716,-0.38569984,-0.36266965,-0.037508953,-0.11112947,-0.26626772,-0.13608791,-0.23127475,-0.3252707,0.19636783,0.04514085,-0.10063473,0.006372064,-0.2515488,-0.17361148,0.25564486,-0.016856732,-0.07871489,0.07387188,0.037228674,0.014604895,0.10752419,-0.043804552,-0.050338656,-0.061347734,-0.04392936,0.085451595,0.022129199,0.07512665,0.1804417,-0.13911742,-0.16869284,-0.16138203,0.2627403,0.22051175,-0.05546995,0.1972254,0.13595538,-0.076629184,-0.07829832,0.10056908,0.09668251,-0.17544056,0.02738175,0.20167047,0.21094443,0.18776335,0.083800904,-0.2310523,-0.04625418,-0.035127465,0.14897327,0.3034852,0.2208586,0.08086032,0.15878764,0.13793711,-0.112076394,0.15921605,0.24082737,-0.12328497,0.064182274,0.027870713,0.23918489,0.18163668,0.003930761,0.0745188,0.08764843,-0.07658271,-0.053791285,-0.1278669,-0.19917916,-0.23983034,-0.016645633,-0.17566516,-0.2659313,-0.15758324,-0.21762218,0.047305323,0.122691564,0.13855647,-0.17361963,-0.22887126,-0.1510251,0.11923073,0.14862208,0.46992564,0.38614348,0.25969672,0.4376481,-0.07292381,-0.09318621,0.21921355,0.029713154,-0.37065312,-0.313032,0.08701664,-0.43805173,-0.43172026,0.5656554,-0.07107067,-0.30257532,0.25738093,-0.04830587,-0.13932216,0.016703762,-0.1702856,-0.21517998,-0.040741224,-0.19927435,-0.3085305,-0.056293946,-0.20505063,-0.035058357,0.05009421,-0.077526085,-0.10057931,0.08637264,-0.006596309,-0.27844685,-0.25915578,-0.23413609,-0.28755403,-0.22859976,-0.105137885,-0.035713345,-0.17804484,-0.041788537,0.039925013,0.09127102,0.12734029,-0.09862424,-0.040018447,0.043930147,0.0075677405,0.20216022,0.2844642,0.2636126,0.021634229,0.074842975,0.07920556,0.008797174,0.17479244,0.18274407,-0.15837432,0.063430876,-0.047460586,0.096927285,0.2494268,0.068779655,0.03049568,0.05173281,-0.08907672,0.26214668,0.27474704,0.04322887,0.090795584,0.32500574,0.33094388,0.14681634,0.0052378364,-0.10883151,0.00700196,0.08462905,0.11467233,-0.16373,-0.28677627,-0.21782725,0.17968842,0.072457515,0.32082805,0.067450196,-0.10684243,0.033630807,-0.09394802,-0.2753635,-0.13557972,0.49990392,0.21099873,-0.0123325195,-0.10344093,-0.6048489,-0.39582524,0.027964212,-0.44096768,-0.486902,-0.0959515,-0.44011045,-0.41051695,0.14819247,-0.09984426,-0.25669247,-0.0861017,-0.35166535,-0.31432605,-0.12569055,-0.190604,-0.25475824,0.05613039,-0.019064575,-0.052200157,-0.19822599,-0.3298482,-0.448931,-0.032315973,-0.19209759,-0.32476228,0.18750627,0.04434391,-0.11646565,-0.17917687,-0.07895207,-0.09198117,0.32027552,0.4147064,0.32644275,0.09126013,0.06948807,-0.035601944,0.13537031,0.23979697,0.20388354,-0.008917311,0.27084818,0.22286214,-0.037415873,0.343994,0.26539266,0.02553108,0.33360097,0.28281507,-0.2325474,0.04125602,0.03790831,-0.15131766,-0.062984765,-0.14694564,-0.3402443,-0.25261638,-0.35540995,-0.060171176,-0.012479783,-0.12408436,0.11720873,0.12355951,-0.032518346,-0.008269045,-0.11743632,-0.22621682,-0.04145507,0.0261445,0.29161394,-0.24384952,-0.28837314,0.012977094,-0.09691628,-0.48433068,-0.34627765,-0.032076817,-0.056466807,0.28740668,-0.31539744,-0.5566733,-0.11100999,0.27008128,0.00032624335,0.19850725,-0.04181894,-0.33939216,-0.22245729,-0.106587484,-0.36779347,-0.26539364,0.17552519,-0.18428631,-0.16489899,0.06332159,-0.18085591,-0.13569772,0.1745636,0.02640268,0.20315306,0.39174595,0.26627016,0.38233185,0.0083690155,-0.12560117,-0.015910728,0.4190259,0.3478432,0.18701403,0.18755299,0.14098054,-0.020545643,-0.14264534,-0.03310599,0.018174034,-0.0024068442,0.11441984,-0.10192585,-0.23297091,-0.068156645,-0.07152409,-0.24448915,0.039607067,0.028333738,-0.07206934,0.067335784,0.13312937,0.084985845,0.22202232,0.2242971,-0.13406691,-0.036208015,0.019118113,-0.35537782,-0.17069107,-0.1986759,-0.05497495,0.016439518,-0.02334699,0.17817716,0.2775367,0.39666903,0.038843073,0.24402657,0.4434088,0.14087845,0.06895771,0.043533523,0.018233636,-0.023694985,-0.009059544,-0.09830095,-0.113600984,0.022878023,-0.20043106,-0.034362838,0.31254268,0.35568216,0.38000035,0.5739312,0.20432656,-0.10897006,-0.016724313,0.08532078,-0.26409814,-0.15664172,0.18447809,-0.15712942,-0.13303666,0.5544116,0.19774303,-0.010676748,0.462908,-0.031665046,-0.12925929,0.051651057,-0.3845665,-0.42058522,0.24602029,-0.013242357,0.08771467,0.11312851,-0.09730218,0.21299273,-0.020517267,-0.20647901,0.04517067,-0.26094234,-0.48448735,-0.30372795,0.09108103,-0.018550333,-0.11157819,-0.0425451,0.021453185,-0.052422665,-0.18662205,-0.026916383,-0.070884794,-0.076939754,-0.020022484,0.13198042,0.06935882,0.1401871,0.2680999,-0.1566523,0.13501535,-0.07772595,0.2353968,0.34950107,0.19690946,0.15286502,0.25846606,0.06973068,0.16444859,0.21615048,-0.061154395,-0.024835138,-0.04802902,-0.22238836,-0.11666728,0.016731244,0.007094736,-0.03735536,0.027810222,0.18239528,-0.110770784,-0.08370792,0.040562212,-0.055356763,0.025692848,0.10571539,0.0808961,0.03082669,0.059443973,-0.12169757,-0.20529686,-0.17945826,-0.26673368,-0.16858894,0.07716542,0.07022889,-0.016443435,0.2179754,0.1707584,-0.2646208,-0.12040264,-0.14671561,-0.53233063,-0.27332827,0.5220068,-0.018338848,-0.014888527,0.20429705,-0.35405675,-0.3401312,0.5713507,0.10894365,0.44387618,0.104892276,-0.17399396,-0.051834393,-0.3302113,-0.6225714,-0.5555311,0.17797992,-0.16395998,0.0012441415,-0.039154183,-0.044446696,0.2211345,0.19997345,-0.09649818,0.13868064,-0.008028206,-0.2774284,-0.25455016,0.414062,0.28383777,0.4243533,-0.015275297,0.008777185,-0.029518185,-0.12140827,0.035329405,0.01677816,-0.65588415,-0.42965484,-0.41371903,-0.0057850243,0.08780198,-0.08091978,0.033858545,0.113321826,-0.021665629,-0.35332385,-0.026617352,-0.09381322,-0.20734262,0.075365104,0.19914041,-0.02169598,0.11477017,0.080543235,0.19200107,0.1605221,0.22217241,0.25830224,0.103391394,0.2127445,0.18336402,-0.06700628,-0.05877156,-0.15600847,-0.32498387,-0.35253042,0.01515599,-0.21899599,-0.10958296,0.06377533,-0.20359159,-0.1466642,0.0054345625,-0.24260563,-0.06336233,0.12541534,-0.24156848,-0.14707687,0.5099314,-0.21640855,-0.19748786,0.36990142,-0.23475112,-0.10680228,0.28951725,-0.23634432,-0.080885135,0.406429,-0.23753649,-0.30258626,0.2647126,-0.37531713,-0.28031334,0.30193007,-0.29563472,-0.26692194,0.38536328,-0.0925172,0.014029162,0.31847858,-0.09732659,0.12596348,0.063974045,-0.09242817,0.25005057,0.15261514,0.070171356,0.46885195,0.2530921,0.09295252,0.27226934,-0.015913224,-0.21134134,-0.20950006,0.4416192,0.319652,0.20896545,-0.12915751,-0.02782016,0.008319681,0.21853447,0.30535114,0.10452876,-0.027424265,0.11809927,-0.1363504,0.27769145,0.24753498,0.15542263,-0.22748649,0.048257973,0.0579844,-0.28021687,-0.023452956,-0.16014184,-0.25946808,-0.046837777,0.00763141,-0.093557596,-0.084479734,0.10574304,0.033498295,-0.1379526,-0.3196236,0.17793196,-0.011107231,0.123157,0.08553232,0.047277216,0.2192584,0.09178831,-0.0019461329,0.26195368,-0.09023375,-0.26905334,-0.03978499,0.30902636,0.027333656,0.25998512,0.1097101,-0.07334386,-0.0058328095,0.012195383,-0.09704912,0.03325961,-0.24122395,-0.4911936,-0.30796477,0.041656613,-0.35008386,-0.09652666,0.39120898,-0.19911347,-0.23673123,0.35353252,-0.36488116,-0.38881198,0.14985374,0.0034510451,0.14467244,-0.21798533,-0.30590823,-0.33063665,0.13675947,-0.043478798,0.07435373,-0.06722948,-0.290107,-0.117213234,0.14279266,-0.16115071,-0.1763519,0.111817636,0.03477109,0.03482115,0.012633722,-0.008770648,-0.08591653,-0.24270801,-0.37751248,-0.58656263,0.066848345,0.09026879,-0.0850128,-0.39395624,-0.34475732,-0.45646486,0.028666202,-0.03849016,-0.2622758,-0.15551443,-0.11387554,-0.3165734,-0.017216649,0.11255096,-0.02712645,-0.12947774,0.13856465,0.14227258,0.032605153,0.14327933,-0.061053723,-0.06397441,0.13793345,-0.044457383,0.20181227,0.09217033,0.008508155,-0.10834414,-0.35688487,-0.33289346,0.2353597,-0.0156101305,0.049603898,-0.0529885,-0.16918534,-0.016205538,0.46973968,0.33634165,0.3781318,0.065358594,-0.07231953,-0.07691259,0.20288512,0.0128811635,-0.07846864,-0.33790502,-0.37573925,-0.05964697,0.033630487,-0.14412118,0.11556233,0.017338747,-0.30318767,-0.013885636,0.21891558,-0.14669715,0.116853446,0.21615319,-0.20000257,-0.1910057,0.13568078,-0.100919314,-0.13438798,0.18965271,-0.044933237,0.26404026,0.3221899,0.10035411,0.13587391,0.23277968,0.016960392,-0.034490943,-0.048905462,-0.31878138,-0.31063756,0.26992914,0.29255456,0.38085163,0.019504173,-0.04010666,-0.108050026,-0.09805649,-0.017154882,-0.10035155,0.5672789,0.4893297,0.09676285,0.07174137,0.1807679,0.05337073,-0.13002802,-0.07620138,-0.1818203,0.037157588,0.028443865,-0.016713325,-0.2087044,0.005603564,-0.07487554,0.012606074,0.124726094,0.0012631335,-0.037925307,-0.092043445,-0.3053292,0.21229589,0.3173289,0.3272577,0.17487031,0.115167074,0.13286503,-0.22594574,-0.27613157,-0.19552857,0.03890022,-0.05411344,0.04253866,0.15015835,0.042081345,0.2335561,-0.083168596,-0.3203351,-0.11362087,0.22064063,0.04460095,0.061719656,0.4319014,0.34562796,0.16736226,-0.30397436,-0.23400761,0.3106936,0.23519713,-0.030178603,0.291362,-0.36570552,-0.555188,-0.33710423,0.097958736,-0.075506546,0.16671859,0.069131434,0.028524991,0.22996941,-0.012475148,-0.21369383,-0.102912374,-0.0058351727,-0.20567265,-0.17658207,-0.15027152,-0.033551212,0.36298662,-0.06408727,0.021367434,0.06188346,0.26318464,0.036094774,0.16475672,0.06781794,-0.21900856,-0.26781052,0.1385544,0.124727234,-0.025922539,0.11106721,0.11906768,0.14878409,-0.0835817,0.0067508165,0.14694825,-0.08946875,0.033438887,0.1295394,0.07543507,0.06025284,-0.13036856,0.018752763,0.13170482,-0.0803127,-0.48159546,-0.13819784,-0.14232388,-0.31378907,-0.10769174,0.072604045,0.25996867,0.19823126,0.012480974,-0.124676906,-0.16660891,-0.06963567,-0.05905603,-0.14850049,-0.0900732,-0.050855998,-0.119433686,0.028684828,-0.086681716,-0.14833824,0.11857956,0.18049553,0.0067231823,0.29663008,-0.2587201,-0.38069978,-0.21816441,0.32215375,0.16607174,0.28874713,0.22504218,0.011096517,0.09514426,-0.32676682,-0.33699286,0.06637908,0.24354367,0.08064497,0.3043236,0.3193415,0.13606887,0.25991338,0.30556327,0.046678778,0.07036696,-0.09789731,-0.2711396,0.06254552,0.09542917,0.08251884,0.32727784,-0.07884212,-0.045566943,0.24174188,-0.11544243,0.026594708,0.21244058,-0.21189155,-0.28866228,-0.165533,0.15522563,0.1440078,0.05090497,0.17184494,0.034870394,-0.124589056,0.06931526,-0.06044311,0.073314376,0.15931553,0.18467109,0.1414803,0.1107014,0.032676443,0.090302445,0.10304323,-0.16037132,-0.22766909,-0.19646572,-0.24744144,-0.34098548,-0.09551788,0.013344048,0.016967067,0.14578076,0.24317749,0.16244878,-0.10421016,0.15024607,0.26461115,-0.0026151824,-0.09021018,-0.23879564,0.06371596,0.05859154,0.034202483,0.09036051,-0.0799909,0.0397438,-0.45237345,-0.5472172,-0.18946609,0.021136506,-0.12705413,0.034331135,0.042505942,-0.1565403,-0.06474686,0.059341703,-0.09008497,0.12871942,-0.024100022,-0.33266184,-0.46063095,-0.045708496,-0.28537595,-0.08546168,0.0014944323,-0.22845298,-0.21889304,0.4599031,0.09732222,0.23032533,0.33708453,-0.11875025,-0.0985326,0.21384598,-0.30519077,-0.123491615,-0.11145817,-0.32130808,-0.04010984,-0.15873604,-0.1399008,0.106067844,-0.13674633,-0.15067284,0.119060636,-0.4107635,-0.39058614,-0.1480204,0.112004295,0.1826599,0.49987394,-0.08467553,-0.18093695,-0.021121243,0.12690496,-0.06977062,0.1635637,-0.0783972,-0.107985884,0.054263562,0.020552315,-0.20161998,-0.18154076,-0.022557577,-0.07582011,-0.07921214,-0.00093169766,-0.083408505,-0.15438974,0.10808889,-0.006147734,-0.080247395,0.12229402,0.14739536,0.06207955,0.08033582,0.17436844,0.18938802,-0.14328445,0.015213175,0.1047581,-0.14743605,0.097274914,0.26068166,-0.024233252,-0.0061756773,0.22744146,-0.13736692,-0.20529704,0.08906644,0.1869796,0.0052858153,0.052724034,0.38988754,0.2766527,0.36238405,-0.1556173,-0.13758811,0.09840397,-0.13949712,-0.18250328,-0.08422163,0.10000923,-0.06435488,0.12067221,-0.2564475,-0.3093749,-0.04098799,0.07450537,0.012454807,-0.08343359,0.10942147,-0.14493622,0.015658306,0.13772613,-0.27690673,-0.26749542,0.17787792,-0.21209913,-0.16367915,0.15290946,0.13811576,0.4007274,0.09869383,-0.082858995,0.198084,-0.18308988,-0.38802016,-0.16578484,-0.1482402,0.04508968,0.3611012,-0.32407933,-0.18005192,0.12754157,-0.057021298,0.0050840755,0.30107555,-0.01346437,0.08692787,0.06972622,-0.19203515,-0.029006256,0.23471093,0.0026211997,-0.03167572,0.113620214,0.1860382,0.08286063,0.11148789,0.3654188,0.21794134,0.2647736,0.12632541,0.06487829,0.09584198,-0.009213279,-0.008326182,0.09813882,-0.2376645,-0.16095802,-0.0013482542,0.08227237,0.14204538,0.313634,-0.22559486,-0.07000928,0.17121808,-0.19461676,-0.09891816,0.24158092,0.16854951,0.044105742,0.23347582,0.28546163,0.1592491,0.29946986,0.07149447,-0.2544447,-0.23916322,0.3033786,0.16843897,0.22584414,0.424964,0.4243526,0.74119586,-0.4779931,-0.43464765,-0.1353558,-0.29245707,-0.25183845,0.08349879,-0.08196589,-0.2387716,-0.13526538,0.022621641,-0.1507083,-0.062961556,0.025808183,-0.323933,-0.24105501,0.37588382,0.19215244,0.07119698,-0.15370782,-0.33054942,-0.10345357,-0.048827607,-0.12395629,-0.01135572,0.47426465,0.32452157,0.22564001,-0.3816829,-0.22916912,-0.07451043,-0.067157954,-0.12842248,-0.064391054,0.37230554,0.16927278,0.06980511,-0.24439768,-0.33915386,-0.3088712,-0.17163514,-0.18933344,0.024310496,-0.058857195,-0.018747834,0.060387425,-0.28644183,-0.23623894,-0.09085812,-0.18409863,-0.045631446,-0.051633876,-0.0013956627,-0.11683344,-0.2043511,2.541783e-06,0.07059328,0.07725261,-0.016649144,0.005308281,0.06913456,-0.20632246,-0.21689138,0.011445677,0.11035934,0.029617023,0.07751258,0.19099614,0.08256102,0.08800165,0.13561916,-0.0055552935,0.10937688,0.30996734,0.060340747,-0.0060732407,0.009884211,-0.38125104,-0.43738818,-0.046643093,-0.17795229,-0.0065446207,0.18744023,0.25276065,0.3438753,-0.17372328,0.063825145,0.1878933,-0.23373838,0.049653336,0.20494,-0.008862057,0.08705649,0.11000368,0.15385626,0.1929741,0.18566267,0.0065725655,0.018817952,-0.08238104,-0.009273816,-0.18867049,-0.09090326,0.0963514,0.024117466,0.31204125,0.2602847,0.1052142,0.24886465,0.36708865,0.14780615,0.23234713,0.15755628,0.060061622,0.11407591,0.05145145,0.038561717,0.19777179,-0.08660784,-0.26866528,-0.21357876,-0.11413579,-0.41484547,-0.1686734,0.00030163542,-0.09137341,0.012331796,0.05644743,0.07821773,0.06586377,-0.17914115,0.0004748246,0.47817045,-0.032624647,-0.020035004,0.086832374,0.0381991,0.01102976,0.050557382,0.05905399,0.10126264,-0.10740642,0.07683086,0.14141768,0.17894065,-0.03115494,0.026393712,0.033887286,-0.027046902,0.0019971586,-0.043796897,-0.06702695,-0.115126655,-0.1913144,0.27147707,0.1399158,0.0168152,0.24331783,0.015057589,-0.027531857,0.45555943,0.050801683,-0.040835153,0.2720121,0.014442351,-0.04704061,0.06567395,-0.0545196,0.067596234,-0.23547783,-0.23600492,0.00068989384,-0.24707304,-0.17252292,-0.074345894,-0.2789634,-0.40451518,-0.42825085,0.21928507,0.18486743,0.21538725,0.08738842,-0.019719722,-0.052908525,0.014901557,-0.08475832,-0.031259656,-0.16557188,-0.12563722,0.073638864,-0.14640605,-0.16090702,-0.13125649,-0.07627736,-0.09650313,-0.018402513,0.035558052,0.08522155,-0.0044621904,0.1900441,0.03880824,0.14353974,0.2241518,0.10332386,0.1440883,0.04570378,-0.27243394,-0.22094855,0.076689124,-0.09212325,0.000461056,0.016413564,-0.18547477,-0.22234932,-0.28016156,-0.30658218,-0.10917242,0.06851756,-0.0042413753,0.047816265,0.25323382,0.044599272,-0.16357014,0.017224593,-0.1116731,-0.16432473,0.14947926,0.082623824,-0.03522175,-0.12792963,-0.064746745,0.040089116,-0.05753757,0.024642661,0.28507322,-0.20393766,-0.14854555,0.03927462,0.16002399,0.097109064,0.12293416,0.119014874,0.028190859,0.083702534,0.2667712,0.005897714,0.014200563,0.021069858,0.07096183,0.0981683,-0.69200623,-0.58681494,-0.09140581,-0.24530941,-0.2753773,-0.21487735,-0.20315948,-0.10487212,0.11655626,0.024279997,0.17647666,0.3788403,0.09699808,0.19648959,0.5607033,0.008706091,0.07422328,0.18392248,-0.4041631,-0.3024794,-0.20523459,-0.14004204,-0.08541422,-0.112645425,-0.05800901,-0.042418722,-0.011646564,-0.1009104,-0.070607536,-0.09337668,-0.14515306,0.08265107,0.19980758,-0.17391996,-0.12971771,-0.011802607,0.30065256,0.19010706,0.26388666,-0.07284205,-0.10140521,0.04708293,0.100574926,-0.008157443,0.26929715,-0.002948638,-0.08587744,-0.088962786,0.16017547,0.076742195,0.016482808,0.14295794,0.14316067,0.18107224,0.13649805,0.10238569,-0.018434545,-0.042193353,-0.15719254,-0.23548757,-0.062446237,-0.118824296,-0.29646915,-0.2993007,-0.25827977,-0.072603375,-0.18531452,-0.029362867,0.20516804,-0.07207706,0.057759654,0.29899752,-0.2482174,-0.22977328,0.017399801,-0.53391224,-0.49024808,-0.14311719,-0.3629478,-0.37631604,-0.025543507,-0.20977725,-0.17506121,0.07438461,-0.061042275,-0.006211451,0.33601987,0.083161004,-0.035639215,0.16091564,-0.012310641,0.06572301,0.17507786,-0.3439283,-0.2546426,0.10325649,-0.026208512,-0.04166947,0.18055253,-0.39125946,-0.19012792,0.03940325,-0.079568446,0.05147765,0.21393716,0.27462474,0.24577062,0.35229674,-0.012156177,0.054516405,0.08588968,-0.020300943,-0.08015082,-0.08525898,-0.13613944,0.09609403,0.22402139,-0.02948828,-0.1953218,0.006427089,0.16966267,0.21219876,0.5879748,0.04482853,-0.00887797,0.10628424,-0.45177862,-0.45419136,-0.08316423,-0.08975051,-0.011657903,0.06904942,-0.17192262,-0.22403568,-0.09676049,-0.3646486,-0.2322276,0.08753104,-0.06717442,0.015756294,0.093954414,0.012604204,0.11123574,0.04779352, /* bias */ -0.22300969};

static inline float sigmoid(const float x)
{
    return 1.f / (1.f + expf(-x));
}

float processModel(const float* input)
{
    float o1 = 0.f;
    for(int i = 0; i < slall; i++)
        o1 += input[i] * aim_model[i]; // weight

    o1 += aim_model[slall]; // bias
    o1 = tanhf(o1);

    return sigmoid((o1 * 13.632906f) + -0.28265148f);
}

/***************************************************
   ~~ Utils
*/
//https://www.cl.cam.ac.uk/~mgk25/ucs/keysymdef.h
//https://stackoverflow.com/questions/18281412/check-keypress-in-c-on-linux/52801588
int key_is_pressed(Display* dpy, KeySym ks)
{
    char keys_return[32];
    XQueryKeymap(dpy, keys_return);
    KeyCode kc2 = XKeysymToKeycode(dpy, ks);
    int isPressed = !!(keys_return[kc2 >> 3] & (1 << (kc2 & 7)));
    return isPressed;
}

unsigned int espeak_fail = 0;
void speakS(const char* text)
{
    if(espeak_fail == 1)
    {
        char s[256];
        sprintf(s, "/usr/bin/espeak \"%s\"", text);
        system(s);
        usleep(33000);
    }
    else
    {
        espeak_Synth(text, strlen(text), 0, 0, 0, espeakCHARS_AUTO,NULL,NULL);
    }
}

uint qRand(const uint min, const uint max)
{
    static float rndmax = (float)RAND_MAX;
    return ( ( (((float)rand())+1e-7f) / rndmax ) * ((max+1)-min) ) + min;
}

uint64_t microtime()
{
    struct timeval tv;
    struct timezone tz;
    memset(&tz, 0, sizeof(struct timezone));
    gettimeofday(&tv, &tz);
    return 1000000 * tv.tv_sec + tv.tv_usec;
}

/***************************************************
   ~~ X11 Utils
*/

Window getWindow(Display* d, const int si) // gets child window mouse is over
{
    XEvent event;
    memset(&event, 0x00, sizeof(event));
    XQueryPointer(d, RootWindow(d, si), &event.xbutton.root, &event.xbutton.window, &event.xbutton.x_root, &event.xbutton.y_root, &event.xbutton.x, &event.xbutton.y, &event.xbutton.state);
    event.xbutton.subwindow = event.xbutton.window;
    while(event.xbutton.subwindow)
    {
        event.xbutton.window = event.xbutton.subwindow;
        XQueryPointer(d, event.xbutton.window, &event.xbutton.root, &event.xbutton.subwindow, &event.xbutton.x_root, &event.xbutton.y_root, &event.xbutton.x, &event.xbutton.y, &event.xbutton.state);
    }
    return event.xbutton.window;
}

Window findWindow(Display *d, Window current, char const *needle)
{
    Window ret = 0, root, parent, *children;
    unsigned cc;
    char *name = NULL;

    if(current == 0)
        current = XDefaultRootWindow(d);

    if(XFetchName(d, current, &name) > 0)
    {
        if(strstr(name, needle) != NULL)
        {
            XFree(name);
            return current;
        }
        XFree(name);
    }

    if(XQueryTree(d, current, &root, &parent, &children, &cc) != 0)
    {
        for(unsigned int i = 0; i < cc; ++i)
        {
            Window win = findWindow(d, children[i], needle);

            if(win != 0)
            {
                ret = win;
                break;
            }
        }
        XFree(children);
    }
    return ret;
}

void writePPM(const char* file, const unsigned char* data)
{
    FILE* f = fopen(file, "wb");
    if(f != NULL)
    {
        fprintf(f, "P6 28 28 255 ");
        fwrite(data, 1, slall, f);
        fclose(f);
    }
}

void saveSample(Window w, const char* name)
{
    // get image block
    XImage *img = XGetImage(d, w, x-sw2, y-sh2, sw, sh, AllPlanes, XYPixmap);
    if(img == NULL)
        return;

    // colour map
    const Colormap map = XDefaultColormap(d, si);

    // extract colour information
    unsigned char rgbbytes[slall] = {0};
    int i = 0;
    for(int y = 0; y < sh; y++)
    {
        for(int x = 0; x < sw; x++)
        {
            XColor c;
            c.pixel = XGetPixel(img, x, y);
            XQueryColor(d, map, &c);

            // 0-1 norm
            rgbbytes[i]   = (unsigned char)((((float)c.red+1e-7f)   / 65535.0f) * 255.0f)+0.5f;
            rgbbytes[++i] = (unsigned char)((((float)c.green+1e-7f) / 65535.0f) * 255.0f)+0.5f;
            rgbbytes[++i] = (unsigned char)((((float)c.blue+1e-7f)  / 65535.0f) * 255.0f)+0.5f;
            i++;
        }
    }

    // free image block
    XFree(img);

    // save to file
    writePPM(name, &rgbbytes[0]);
}

void processScanArea(Window w)
{
    // get image block
    XImage *img = XGetImage(d, w, x-sw2, y-sh2, sw, sh, AllPlanes, XYPixmap);
    if(img == NULL)
        return;

    // colour map
    const Colormap map = XDefaultColormap(d, si);

    // extract colour information
    int i = 0;
    for(int y = 0; y < sh; y++)
    {
        for(int x = 0; x < sw; x++)
        {
            XColor c;
            c.pixel = XGetPixel(img, x, y);
            XQueryColor(d, map, &c);

            // 0-1 norm
            input[i]   = c.red   / 65535.f;
            input[i+1] = c.green / 65535.f;
            input[i+2] = c.blue  / 65535.f;
            i += 3;
        }
    }

    // free image block
    XFree(img);
}

/***************************************************
   ~~ Console Utils
*/

int gre()
{
    int r = 0;
    while(r == 0 || r == 15 || r == 16 || r == 189)
    {
        r = (rand()%229)+1;
    }
    return r;
}
void random_printf(const char* text)
{
    const unsigned int len = strlen(text);
    for(unsigned int i = 0; i < len; i++)
    {
        printf("\e[38;5;%im", gre());
        printf("%c", text[i]);
    }
    printf("\e[38;5;123m");
}

void rainbow_printf(const char* text)
{
    static unsigned int base_clr = 0;
    if(base_clr == 0)
        base_clr = (rand()%125)+55;
    
    base_clr += 3;

    unsigned int clr = base_clr;
    const unsigned int len = strlen(text);
    for(unsigned int i = 0; i < len; i++)
    {
        clr++;
        printf("\e[38;5;%im", clr);
        printf("%c", text[i]);
    }
    printf("\e[38;5;123m");
}

void rainbow_line_printf(const char* text)
{
    static unsigned int base_clr = 0;
    if(base_clr == 0)
        base_clr = (rand()%125)+55;
    
    printf("\e[38;5;%im", base_clr);
    base_clr++;
    if(base_clr >= 230)
        base_clr = (rand()%125)+55;

    const unsigned int len = strlen(text);
    for(unsigned int i = 0; i < len; i++)
        printf("%c", text[i]);
    printf("\e[38;5;123m");
}

/***************************************************
   ~~ Program Entry Point
*/
int main()
{
    srand(time(0));

    if(espeak_Initialize(AUDIO_OUTPUT_SYNCH_PLAYBACK, 0, 0, 0) < 0)
        espeak_fail = 1;

    printf("\033[H\033[J");
    rainbow_printf("James William Fletcher (github.com/mrbid)\n\n");
    rainbow_printf("L-CTRL + L-ALT = Toggle BOT ON/OFF\n");
    rainbow_printf("R-CTRL + R-ALT = Toggle HOTKEYS ON/OFF\n");
    rainbow_printf("P = Toggle crosshair\n\n");
    rainbow_printf("L = Toggle sample capture\n");
    rainbow_printf("Q = Capture non-target sample\n\n");
    rainbow_printf("G = Get activation for reticule area.\n");
    rainbow_printf("H = Get scans per second.\n");
    rainbow_printf("\nDisable the game crosshair or make the crosshair a single green pixel, or if your monitor provides a crosshair use that.\n\n");
    rainbow_printf("This bot will only auto trigger when W,A,S,D are not being pressed. (so when your not moving in game, aka stationary)\n\n");
    

    xdo_t* xdo;
    XColor c[9];
    GC gc = 0;
    unsigned int enable = 0;
    unsigned int offset = 3;
    unsigned int crosshair = 0;
    unsigned int sample_capture = 0;
    unsigned int hotkeys = 1;
    unsigned int draw_sa = 0;
    time_t ct = time(0);

    // open display 0
    d = XOpenDisplay(":0");
    if(d == NULL)
    {
        printf("Failed to open display\n");
        return 0;
    }

    // get default screen
    si = XDefaultScreen(d);

    // find bottom window
    twin = findWindow(d, 0, "Counter-Strike");
    if(twin != 0)
        printf("CS:GO Win: 0x%lX\n", twin);

    //xdo
    xdo = xdo_new(":0.0");

    // set console title
    Window awin;
    xdo_get_active_window(xdo, &awin);
    xdo_set_window_property(xdo, awin, "WM_NAME", "CS:GO GOLD FNN");

    // get graphics context
    gc = DefaultGC(d, si);
    
    while(1)
    {
        // loop every 1 ms (1,000 microsecond = 1 millisecond)
        usleep(SCAN_DELAY);

        // inputs
        if(key_is_pressed(d, XK_Control_L) && key_is_pressed(d, XK_Alt_L))
        {
            if(enable == 0)
            {                
                // get window
                twin = findWindow(d, 0, "Counter-Strike");

                // get center window point (x & y)
                XWindowAttributes attr;
                XGetWindowAttributes(d, twin, &attr);
                x = attr.width/2;
                y = attr.height/2;

                // toggle
                enable = 1;
                usleep(300000);
                rainbow_line_printf("BOT: ON ");
                printf("[%ix%i]\n", x, y);
                speakS("on");
            }
            else
            {
                enable = 0;
                usleep(300000);
                rainbow_line_printf("BOT: OFF\n");
                speakS("off");
            }
        }
        
        // bot on/off
        if(enable == 1)
        {
            // input toggle
            if(key_is_pressed(d, XK_Control_R) && key_is_pressed(d, XK_Alt_R))
            {
                if(hotkeys == 0)
                {
                    hotkeys = 1;
                    usleep(300000);
                    printf("HOTKEYS: ON [%ix%i]\n", x, y);
                    speakS("hk on");
                }
                else
                {
                    hotkeys = 0;
                    usleep(300000);
                    rainbow_line_printf("HOTKEYS: OFF\n");
                    speakS("hk off");
                }
            }

            if(hotkeys == 1)
            {
                // crosshair toggle
                if(key_is_pressed(d, XK_P))
                {
                    if(crosshair == 0)
                    {
                        crosshair = 1;
                        usleep(300000);
                        rainbow_line_printf("CROSSHAIR: ON\n");
                        speakS("cx on");
                    }
                    else
                    {
                        crosshair = 0;
                        usleep(300000);
                        rainbow_line_printf("CROSSHAIR: OFF\n");
                        speakS("cx off");
                    }
                }

                static uint64_t scd = 0;
                if(key_is_pressed(d, XK_Q) && sample_capture == 1 && microtime() > scd)
                {
                    char name[32];
                    sprintf(name, "%s/%i.ppm", nontargets_dir, rand());
                    saveSample(twin, name);

                    draw_sa = 100;

                    scd = microtime() + 350000;
                }

                // sample capture toggle
                if(key_is_pressed(d, XK_L))
                {
                    if(sample_capture == 0)
                    {
                        char* home = getenv("HOME");
                        sprintf(targets_dir, "%s/Desktop/targets", home);
                        mkdir(targets_dir, 0777);
                        sprintf(nontargets_dir, "%s/Desktop/nontargets", home);
                        mkdir(nontargets_dir, 0777);

                        sample_capture = 1;
                        usleep(300000);
                        rainbow_line_printf("SAMPLE CAPTURE: ON\n");
                        speakS("sc on");
                    }
                    else
                    {
                        sample_capture = 0;
                        usleep(300000);
                        rainbow_line_printf("SAMPLE CAPTURE: OFF\n");
                        speakS("sc off");
                    }
                }

                if(key_is_pressed(d, XK_G)) // print activation when pressed
                {
                    processScanArea(twin);
                    const float ret = processModel(&input[0]);
                    if(ret >= ACTIVATION_SENITIVITY)
                    {
                        printf("\e[93mA: %f\e[0m\n", ret);
                        XSetForeground(d, gc, 65280);
                        XDrawRectangle(d, twin, gc, x-sw2-1, y-sh2-1, sw+2, sh+2);
                        XSetForeground(d, gc, 0);
                        XDrawRectangle(d, twin, gc, x-sw2-2, y-sh2-2, sw+4, sh+4);
                        XFlush(d);
                    }
                    else
                    {
                        printf("A: %f\n", ret);
                        XSetForeground(d, gc, 16711680);
                        XDrawRectangle(d, twin, gc, x-sw2-1, y-sh2-1, sw+2, sh+2);
                        XSetForeground(d, gc, 0);
                        XDrawRectangle(d, twin, gc, x-sw2-2, y-sh2-2, sw+4, sh+4);
                        XFlush(d);
                    }
                }

                if(key_is_pressed(d, XK_H)) // print samples per second when pressed
                {
                    static uint64_t st = 0;
                    static uint sc = 0;
                    processScanArea(twin);
                    const float ret = processModel(&input[0]);
                    sc++;
                    if(microtime() - st >= 1000000)
                    {
                        printf("\e[36mSPS: %u\e[0m\n", sc);
                        sc = 0;
                        st = microtime();
                    }              
                }
            }

            if(key_is_pressed(d, XK_W) == 0 && key_is_pressed(d, XK_A) == 0 && key_is_pressed(d, XK_S) == 0 && key_is_pressed(d, XK_D) == 0)
            {
                processScanArea(twin);
                const float activation = processModel(&input[0]);
                if(activation >= ACTIVATION_SENITIVITY)
                {
                    tc++;

                    // did we activate enough times in a row to be sure this is a target?
                    if(tc > REPEAT_ACTIVATION)
                    {
                        if(sample_capture == 1)
                        {
                            char name[32];
                            sprintf(name, "%s/%i.ppm", targets_dir, rand());
                            saveSample(twin, name);
                        }

                        xdo_mouse_down(xdo, CURRENTWINDOW, 1);
                        usleep(100000);
                        xdo_mouse_up(xdo, CURRENTWINDOW, 1);

                        if(sample_capture == 1)
                            usleep(350000); //sleep(1);

                        // display ~1s recharge time
                        if(crosshair != 0)
                        {
                            crosshair = 2;
                            ct = time(0);
                        }
                    }
                }
                else
                {
                    tc = 0;
                }
            }

            if(crosshair == 1)
            {
                if(sample_capture == 1)
                {
                    if(draw_sa > 0)
                    {
                        // draw sample outline
                        XSetForeground(d, gc, 16711680);
                        XDrawRectangle(d, twin, gc, x-sw2-1, y-sh2-1, sw+2, sh+2);
                        XSetForeground(d, gc, 16711680);
                        XDrawRectangle(d, twin, gc, x-sw2-2, y-sh2-2, sw+4, sh+4);
                        XFlush(d);
                        draw_sa -= 1;
                    }
                    else
                    {
                        XSetForeground(d, gc, 16777215);
                        XDrawRectangle(d, twin, gc, x-sw2-1, y-sh2-1, sw+2, sh+2);
                        XSetForeground(d, gc, 16776960);
                        XDrawRectangle(d, twin, gc, x-sw2-2, y-sh2-2, sw+4, sh+4);
                        XFlush(d);
                    }
                }
                else
                {
                    XSetForeground(d, gc, 65280);
                    XDrawRectangle(d, twin, gc, x-sw2-1, y-sh2-1, sw+2, sh+2);
                    XFlush(d);
                }
            }

            if(crosshair == 2)
            {
                if(time(0) > ct+1)
                    crosshair = 1;

                if(sample_capture == 1)
                {
                    XSetForeground(d, gc, 16777215);
                    XDrawRectangle(d, twin, gc, x-sw2-1, y-sh2-1, sw+2, sh+2);
                    XSetForeground(d, gc, 16711680);
                    XDrawRectangle(d, twin, gc, x-sw2-2, y-sh2-2, sw+4, sh+4);
                    XFlush(d);
                }
                else
                {
                    XSetForeground(d, gc, 16711680);
                    XDrawRectangle(d, twin, gc, x-sw2-1, y-sh2-1, sw+2, sh+2);
                    XSetForeground(d, gc, 65280);
                    XDrawRectangle(d, twin, gc, x-sw2-2, y-sh2-2, sw+4, sh+4);
                    XFlush(d);
                }
            }
        }

        //
    }

    // done, never gets here in regular execution flow
    XCloseDisplay(d);
    return 0;
}

